{% extends 'base.html' %}
{% block title %}Contact Us{% endblock %}
{% block content %}
<div class="container my-5">
<br><br><br><br>
    <h1>Contact Us by form</h1>



    {% if service %}
        <h4 class="mb-3">Service: {{ service.name }}</h4>
    {% endif %}

    <form method="POST" enctype="multipart/form-data">
        <!-- Name -->
        <div class="mb-3">
            <label for="name" class="form-label">Name</label>
            <input type="text" class="form-control" id="name" name="name" required>
        </div>

        <!-- Email -->
        <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" class="form-control" id="email" name="email" required>
        </div>

        <!-- Message -->
        <div class="mb-3">
            <label for="message" class="form-label">Message</label>
            <textarea class="form-control" id="message" name="message" rows="5" required></textarea>
        </div>

        <!-- Hidden Input for Selected Images -->
        <input type="hidden" name="selected_gallery_images" id="selected_gallery_images_input">

        <!-- Gallery Navigation Links -->
        <div class="mb-3">
            <p class="mb-1"><strong>Browse Gallery by Category:</strong></p>
            {% for category, images in all_gallery_data.items() %}
                <a href="#cat-{{ category }}" class="btn btn-outline-primary btn-sm mb-1 me-1">{{ category.replace('_', ' ').title() }}</a>
            {% endfor %}
        </div>

        <!-- Upload Your Own Images & Submit Button -->
        <div class="mb-4">
            <label for="upload_images" class="form-label">Upload Your Own Images (optional)</label>
            <input type="file" class="form-control mb-3" id="upload_images" name="uploaded_images" accept="image/*" multiple>

            <div class="text-center">
                <button type="submit" class="btn btn-success btn-lg">Send Message</button>
            </div>
        </div>



        <!-- Gallery Selection by Category -->
        <div class="mb-4">
            {% for category, images in all_gallery_data.items() %}
                <h5 id="cat-{{ category }}" class="mt-3">{{ category.replace('_', ' ').title() }}</h5>
                <p class="mb-2">Click images to select them (optional).</p>
                <div class="d-flex flex-wrap gap-2">
                    {% for img in images %}
                        <label class="gallery-item" style="cursor:pointer; flex:0 0 calc(16.66% - 0.5rem);">
                            <input type="checkbox" name="gallery_image" value="{{ img.filename }}" class="gallery-checkbox d-none">
                            <img src="{{ url_for('static', filename='images/' + img.category + '/' + img.filename) }}"
                                 alt="Gallery Image"
                                 class="img-fluid border rounded selection-image">
                        </label>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
    </form>
</div>

<!-- CSS for selected gallery images -->
<style>
.selection-image {
    transition: 0.2s;
    width: 100%;
    height: 150px;
    object-fit: cover;
    border-radius: 8px;
}

input[type="checkbox"]:checked + .selection-image {
    border: 3px solid #0d6efd;
    transform: scale(0.95);
}

.gallery-item {
    margin-bottom: 0.5rem;
    overflow: hidden;
}
</style>

<!-- JavaScript for handling multiple image selections -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    const checkboxes = document.querySelectorAll('.gallery-checkbox');
    const hiddenInput = document.getElementById('selected_gallery_images_input');
    let selectedImages = [];

    checkboxes.forEach(checkbox => {
        const img = checkbox.nextElementSibling;
        img.addEventListener('click', () => {
            checkbox.checked = !checkbox.checked;
            const filename = checkbox.value;
            if (checkbox.checked) {
                if (!selectedImages.includes(filename)) {
                    selectedImages.push(filename);
                }
            } else {
                selectedImages = selectedImages.filter(f => f !== filename);
            }
            hiddenInput.value = selectedImages.join(',');
            img.classList.toggle('border-primary', checkbox.checked);
            console.log('Current selected images:', selectedImages);
        });
    });

    const form = document.querySelector('form');
    form.addEventListener('submit', () => {
        hiddenInput.value = selectedImages.join(',');
        console.log('Submitting selected images:', hiddenInput.value);
    });
});
</script>
{% endblock %}